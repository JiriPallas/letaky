<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kupony</title>
  <style>
    body { font-family: sans-serif; margin: 0; background: #f4f4f4; }
    header { background: #222; color: white; padding: 1rem; display: flex; align-items: center; }
    header img { height: 50px; margin-right: 1rem; }
    header h1 { font-size: 1.5rem; }
    main { max-width: 960px; margin: 2rem auto; padding: 0 1rem; }
    .galerie { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
    .polozka { background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 6px rgba(0,0,0,0.1); text-align: center; padding-bottom: 1rem; }
    .polozka img { width: 100%; height: auto; display: block; }
    .polozka p { margin: 0.5rem; font-weight: bold; }
    .polozka .qr { margin-top: 0.5rem; }
    .kategorie { margin-top: 2rem; text-align: center; }
    .kategorie a { margin: 0.5rem; text-decoration: none; padding: 0.5rem 1rem; background: #0066cc; color: white; border-radius: 5px; display: inline-block; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
</head>
<body>
  <header>
    <img src="logo.png" alt="Logo">
    <h1>Letákové kupony</h1>
  </header>

  <main>
    <section class="galerie" id="galerie"></section>

    <section class="kategorie" id="kategorie">
      <h2>Kategorie</h2>
    </section>
  </main>

  <script>
    const uploads = JSON.parse(localStorage.getItem('adminUploads') || '[]');
    const galerie = document.getElementById('galerie');
    const kategorieSet = new Set();

    uploads.forEach(entry => kategorieSet.add(entry.category));

    uploads.slice(-10).reverse().forEach(entry => {
      const div = document.createElement('div');
      div.className = 'polozka';

      const fileURL = entry.fileName.startsWith('blob:')
        ? entry.fileName
        : URL.createObjectURL(new Blob([entry.fileBlob] || []));

      const img = document.createElement('img');
      img.src = fileURL;
      img.alt = entry.description;

      const desc = document.createElement('p');
      desc.textContent = entry.description;

      const qr = document.createElement('canvas');
      qr.className = 'qr';
      new QRious({
        element: qr,
        value: `detail.html?id=${entry.id}`,
        size: 100
      });

      div.appendChild(img);
      div.appendChild(desc);
      div.appendChild(qr);
      galerie.appendChild(div);
    });

    const kategorieEl = document.getElementById('kategorie');
    kategorieSet.forEach(cat => {
      const a = document.createElement('a');
      a.href = `${cat.toLowerCase().replace(/ /g, '-')}.html`;
      a.textContent = cat;
      kategorieEl.appendChild(a);
    });
  </script>
</body>
</html>
