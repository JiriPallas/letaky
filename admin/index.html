
<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Admin - Nová položka</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCFlTsn1ESQddd_7Neq-W6LBGRiT92c-5w",
      authDomain: "letaky-aa6ab.firebaseapp.com",
      databaseURL: "https://letaky-aa6ab-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "letaky-aa6ab",
      storageBucket: "letaky-aa6ab.appspot.com",
      messagingSenderId: "814346215288",
      appId: "1:814346215288:web:445f9700dac9b81cd8f28d"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    window.onload = () => {
      const fromDate = document.getElementById('fromDate');
      const duration = document.getElementById('duration');
      const toDate = document.getElementById('toDate');

      const today = new Date().toISOString().split("T")[0];
      fromDate.value = today;
      duration.value = 30;
      updateToDate();

      fromDate.addEventListener("input", updateToDate);
      duration.addEventListener("input", updateToDate);

      document.getElementById("form").addEventListener("submit", async (e) => {
        e.preventDefault();

        const type = document.querySelector("input[name='type']:checked")?.value;
        const entry = {
          imageUrl: document.getElementById("imageUrl").value.trim(),
          category: document.getElementById("category").value.trim(),
          description: document.getElementById("description").value.trim(),
          fromDate: document.getElementById("fromDate").value.trim(),
          toDate: document.getElementById("toDate").value.trim(),
          type: type,
          archived: false
        };
        if (type === "zbozi") {
          entry.price = parseInt(document.getElementById("price").value.trim(), 10);
        }

        // Validering
        if (!entry.imageUrl || !entry.category || !entry.description || !entry.fromDate || !entry.toDate || !entry.type) {
          alert("Vyplňte prosím všechna povinná pole.");
          return;
        }

        await push(ref(db), entry);
        alert("Položka byla uložena!");
        e.target.reset();
        fromDate.value = today;
        duration.value = 30;
        updateToDate();
      });

      function updateToDate() {
        const start = new Date(fromDate.value);
        const days = parseInt(duration.value, 10);
        if (!isNaN(start) && !isNaN(days)) {
          const end = new Date(start);
          end.setDate(end.getDate() + days);
          toDate.value = end.toISOString().split("T")[0];
        }
      }

      document.querySelectorAll("input[name='type']").forEach(radio => {
        radio.addEventListener("change", () => {
          document.getElementById("priceGroup").style.display =
            document.getElementById("zbozi").checked ? "block" : "none";
        });
      });
    };
  </script>
</head>
<body>
  <h1>Nová položka</h1>
  <form id="form">
    <label>Adresa obrázku / videa:</label><br />
    <input type="url" id="imageUrl" required /><br />

    <label>Kategorie:</label><br />
    <input type="text" id="category" required /><br />

    <label>Popis:</label><br />
    <textarea id="description" required></textarea><br />

    <label>Typ položky:</label><br />
    <label><input type="radio" name="type" value="letak" checked /> Leták</label>
    <label><input type="radio" name="type" value="zbozi" id="zbozi" /> Zboží</label><br />

    <div id="priceGroup" style="display:none;">
      <label>Cena:</label><br />
      <input type="number" id="price" min="0" /><br />
    </div>

    <label>Zobrazit od:</label><br />
    <input type="date" id="fromDate" required /><br />

    <label>Počet dní zobrazení:</label><br />
    <input type="number" id="duration" min="1" required /><br />

    <label>Zobrazit do:</label><br />
    <input type="date" id="toDate" required /><br /><br />

    <button type="submit">Uložit</button>
  </form>
</body>
</html>
