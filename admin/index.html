<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Nov√° polo≈æka</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; background: #f4f4f4; }
    form { max-width: 600px; margin: auto; background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
    input, textarea, select { width: 100%; margin-bottom: 1rem; padding: 0.5rem; font-size: 1rem; }
    label { font-weight: bold; }
    .preview { max-width: 600px; margin: 2rem auto; text-align: center; }
    img { max-width: 100%; border-radius: 5px; }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>

<h1>Nov√° polo≈æka</h1>

<form id="uploadForm">
  <label for="imageUrl">Adresa obr√°zku</label>
  <input type="url" id="imageUrl" required>

  <label for="category">Kategorie</label>
  <select id="category" required>
    <option value="">-- Vyberte --</option>
    <option>Potraviny</option>
    <option>Motorov√° vozidla</option>
    <option>Bydlen√≠</option>
    <option>≈†aty</option>
    <option>Sportovn√≠ pot≈ôeby</option>
    <option>Elektronika</option>
    <option>Ostatn√≠</option>
  </select>

  <label>Typ polo≈æky</label><br>
  <label><input type="radio" name="type" value="letak" checked> Let√°k</label>
  <label><input type="radio" name="type" value="zbozi"> Zbo≈æ√≠</label>

  <div id="priceWrapper" style="display:none;">
    <label for="price">Cena (Kƒç)</label>
    <input type="number" id="price" min="0">
  </div>

  <label for="description">Popis</label>
  <textarea id="description" required></textarea>

  <label for="fromDate">Zobrazit od</label>
  <input type="date" id="fromDate" required>

  <label for="toDate">Zobrazit do</label>
  <input type="date" id="toDate" required>

  <button type="submit">Ulo≈æit</button>
</form>

<div class="preview" id="previewContainer"></div>

<script>
  // üî• Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyCFlTsn1ESQddd_7Neq-W6LBGRiT92c-5w",
    authDomain: "letaky-aa6ab.firebaseapp.com",
    databaseURL: "https://letaky-aa6ab-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "letaky-aa6ab",
    storageBucket: "letaky-aa6ab.appspot.com",
    messagingSenderId: "814346215288",
    appId: "1:814346215288:web:445f9700dac9b81cd8f28d"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const form = document.getElementById("uploadForm");
  const priceWrapper = document.getElementById("priceWrapper");
  const previewContainer = document.getElementById("previewContainer");

  // Visa prisf√§lt om zbozi
  form.type.forEach(radio => {
    radio.addEventListener("change", () => {
      priceWrapper.style.display = form.type.value === "zbozi" ? "block" : "none";
    });
  });

  form.addEventListener("submit", e => {
    e.preventDefault();

    const type = form.type.value;
    const entry = {
      id: "ID-" + Math.random().toString(36).substring(2, 9),
      imageUrl: form.imageUrl.value.trim(),
      category: form.category.value.trim(),
      description: form.description.value.trim(),
      fromDate: form.fromDate.value,
      toDate: form.toDate.value,
      type,
      archived: false
    };

    if (type === "zbozi") {
      const price = parseInt(document.getElementById("price").value);
      if (!price || price <= 0) {
        alert("Zadejte cenu");
        return;
      }
      entry.price = price;
    }

    db.ref("uploads").push(entry).then(() => {
      alert("Polo≈æka byla ulo≈æena!");
      showPreview(entry);
      form.reset();
      priceWrapper.style.display = "none";
    }).catch(err => {
      console.error("Chyba p≈ôi ukl√°d√°n√≠:", err);
      alert("Chyba p≈ôi ukl√°d√°n√≠ dat.");
    });
  });

  function showPreview(item) {
    const html = `
      <h2>N√°hled ulo≈æen√© polo≈æky</h2>
      <img src="${item.imageUrl}" alt="${item.description}">
      <p><strong>${item.description}</strong></p>
      <p>Kategorie: ${item.category}</p>
      <p>Typ: ${item.type}</p>
      ${item.price ? `<p>Cena: ${item.price} Kƒç</p>` : ""}
      <p>Platnost: ${item.fromDate} ‚Äì ${item.toDate}</p>
    `;
    previewContainer.innerHTML = html;
  }
</script>

</body>
</html>
