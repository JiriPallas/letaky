
<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HitTV – Detail</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; background: #f7f7f7; }
    h1 { font-size: 2rem; margin-bottom: 1rem; }
    h1 a { text-decoration: none; color: #000; }
    .image { margin-bottom: 2rem; }
    .info-row { display: flex; gap: 2rem; }
    .left { flex: 0 0 100px; }
    .right { flex: 1; }
    .label { font-weight: bold; }
    .actions { margin-top: 2rem; display: flex; flex-wrap: wrap; gap: 1rem; }
    button, a.button { padding: 0.5rem 1rem; font-size: 1rem; cursor: pointer; text-decoration: none; background: #007bff; color: white; border-radius: 5px; border: none; }
  </style>
</head>
<body>
  <h1><a href="https://hittv.netlify.app/">HitTV</a></h1>
  <div class="image">
    <img id="mainImage" src="" alt="náhled" style="max-width: 100%; border-radius: 8px;" />
  </div>
  <div class="info-row">
    <div class="left">
      <img id="qrCode" src="" alt="QR kód" width="100" height="100" />
    </div>
    <div class="right">
      <div><span class="label">Kategorie:</span> <span id="category"></span></div>
      <div><span class="label">Popis:</span> <span id="description"></span></div>
      <div id="priceRow" style="display:none;"><span class="label">Cena:</span> <span id="price"></span> Kč</div>
    </div>
  </div>
  <div class="actions">
    <button id="buyButton" style="display:none;">Koupit</button>
    <button onclick="shareItem()">Sdílet</button>
    <button onclick="downloadImage()">Uložit</button>
    <a href="https://hittv.netlify.app/" class="button">Hlavní stránka</a>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js';
    import { getDatabase, ref, get, child } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js';

    const firebaseConfig = {
      apiKey: "AIzaSyCFlTsn1ESQddd_7Neq-W6LBGRiT92c-5w",
      authDomain: "letaky-aa6ab.firebaseapp.com",
      databaseURL: "https://letaky-aa6ab-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "letaky-aa6ab",
      storageBucket: "letaky-aa6ab.firebasestorage.app",
      messagingSenderId: "814346215288",
      appId: "1:814346215288:web:445f9700dac9b81cd8f28d"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    function getIdFromUrl() {
      const params = new URLSearchParams(window.location.search);
      return params.get("id");
    }

    const id = getIdFromUrl();
    if (!id) {
      document.body.innerHTML = "<p>Chybné ID položky.</p>";
      throw new Error("Missing ID");
    }

    const itemRef = ref(db, "items/" + id);
    get(itemRef).then(snapshot => {
      if (!snapshot.exists()) {
        document.body.innerHTML = "<p>Položka nebyla nalezena.</p>";
        return;
      }
      const item = snapshot.val();
      const today = new Date().toISOString().split("T")[0];
      if (item.toDate < today) {
        const msg = document.createElement("p");
        msg.textContent = `Nabídka platná pouze do ${item.toDate}`;
        msg.style = "color:red;font-weight:bold;margin-bottom:1rem;";
        document.body.prepend(msg);
      }

      document.getElementById("mainImage").src = item.imageUrl;
      document.getElementById("qrCode").src = `https://api.qrserver.com/v1/create-qr-code/?size=100x100&format=svg&data=https://hittv.netlify.app/detail.html?id=${id}`;
      document.getElementById("category").textContent = item.category;
      document.getElementById("description").textContent = item.description;
      if (item.type === "zbozi") {
        document.getElementById("price").textContent = item.price;
        document.getElementById("priceRow").style.display = "block";
        document.getElementById("buyButton").style.display = "inline-block";
      }
    }).catch(err => {
      document.body.innerHTML = "<p>Chyba při načítání položky.</p>";
      console.error(err);
    });

    window.downloadImage = () => {
      const url = document.getElementById("mainImage").src;
      const link = document.createElement("a");
      link.href = url;
      link.download = "nabidka.jpg";
      link.click();
    };

    window.shareItem = () => {
      const url = window.location.href;
      if (navigator.share) {
        navigator.share({ title: "HitTV", url }).catch(err => console.log("Chyba při sdílení:", err));
      } else {
        prompt("Zkopírujte odkaz:", url);
      }
    };
  </script>
</body>
</html>
