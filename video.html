<!-- video.html v1.2 -->
<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HitTV – Video</title>
    <style>
        body {
            margin: 0;
            background: black;
            color: white;
            font-family: sans-serif;
        }

        #logo {
            padding: 1rem;
            font-size: 2rem;
            font-weight: bold;
        }

        #container {
            display: flex;
            height: 90vh;
            gap: 1rem;
            padding: 1rem;
        }

        #mainContent {
            flex: 2;
            background: #111;
            padding: 1rem;
            border-radius: 8px;
        }

        #sidebar {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .mini {
            background: #222;
            padding: 0.5rem;
            border-radius: 8px;
            text-align: center;
        }

        .mini img {
            max-width: 100%;
            border-radius: 4px;
        }

        video {
            width: 100%;
            border-radius: 8px;
        }
    </style>
</head>

<body>
    <div id="logo">
        <a href="https://hittv.netlify.app/" style="color:white;text-decoration:none;">HitTV</a>
    </div>
    <div id="container">
        <div id="mainContent">Načítání…</div>
        <div id="sidebar"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCFlTsn1ESQddd_7Neq-W6LBGRiT92c-5w",
            authDomain: "letaky-aa6ab.firebaseapp.com",
            databaseURL: "https://letaky-aa6ab-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "letaky-aa6ab",
            storageBucket: "letaky-aa6ab.appspot.com",
            messagingSenderId: "814346215288",
            appId: "1:814346215288:web:445f9700dac9b81cd8f28d"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const params = new URLSearchParams(window.location.search);
        const ids = params.getAll("id");
        const mainContent = document.getElementById("mainContent");
        const sidebar = document.getElementById("sidebar");

        let items = [];

        function isVideoFile(url) {
            return /\.(mp4|webm)$/i.test(url);
        }

        function showItem(item) {
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=https://hittv.netlify.app/detail.html?id=${item.id}`;

            const mediaHtml = isVideoFile(item.imageUrl)
                ? `<video src="${item.imageUrl}" autoplay muted loop playsinline></video>`
                : `<img src="${item.imageUrl}" alt="obrázek" style="width:100%;border-radius:8px;">`;

            mainContent.innerHTML = `
        ${mediaHtml}
        <div style="margin-top:1rem;">
          <p><strong>Kategorie:</strong> ${item.category}</p>
          <p><strong>Popis:</strong> ${item.description}</p>
          ${item.type === "zbozi" ? `<p><strong>Cena:</strong> ${item.price} Kč</p>` : ""}
          <img src="${qrUrl}" alt="QR" style="margin-top:1rem;" />
        </div>
      `;
        }

        function addSidebarItem(item) {
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=80x80&data=https://hittv.netlify.app/detail.html?id=${item.id}`;
            const mini = document.createElement("div");
            mini.className = "mini";
            mini.innerHTML = `
        ${isVideoFile(item.imageUrl)
                    ? `<video src="${item.imageUrl}" autoplay muted loop playsinline></video>`
                    : `<img src="${item.imageUrl}" alt="náhled">`}
        <img src="${qrUrl}" alt="QR kód">
      `;
            sidebar.appendChild(mini);
        }

        async function loadItems() {
            const dbRef = ref(db);
            for (const id of ids) {
                const snapshot = await get(child(dbRef, `items/${id}`));
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    data.id = id;
                    items.push(data);
                    addSidebarItem(data);
                }
            }
            runSlideshow();
        }

        function runSlideshow() {
            let index = 0;
            showItem(items[index]);
            setInterval(() => {
                index = (index + 1) % items.length;
                showItem(items[index]);
            }, 5000);
        }

        loadItems();
    </script>
</body>

</html>